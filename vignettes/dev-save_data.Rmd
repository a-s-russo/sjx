---
title: "dev-save_data"
output: rmarkdown::html_vignette
subtitle: "Save data"
author: "Anthony Russo"
date: "`r Sys.Date()`"
vignette: >
  %\VignetteIndexEntry{dev-save_data}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(timeseriescomparison)
```

<!-- WARNING - This vignette is generated by {fusen} from dev/flat_save_data.Rmd: do not edit by hand -->

## Seasonal adjustment and trending

A time series is a collection of well-defined data observed regularly through
time. Seasonal adjustment is an analytical method to estimate and remove
seasonal and calendar-related impacts from a time series. Trending is an
analytical method to estimate the long-term, underlying direction of a time
series.

This analysis compares the seasonal adjustment and trending methods produced by
the following three programs:

* [SEASABS](https://www.abs.gov.au/websitedbs/d3310114.nsf/4a256353001af3ed4b2562bb00121564/c890aa8e65957397ca256ce10018c9d8!OpenDocument) (used by Australia's national statistical agency)

* [X-13ARIMA-SEATS](https://www.census.gov/data/software/x13as.html) (used by
the United States Census Bureau)

* [JDemetra+](https://jdemetradocumentation.github.io/JDemetra-documentation/)
(used by many European statistical agencies and central banks)

Published seasonally adjusted and trend estimates of time series data from the
Australian Bureau of Statistics (generated via SEASABS) are compared against the
output generated by executing the X-13ARIMA-SEATS and JDemetra+ programs. Since
SEASABS is not freely available, the estimates are referenced directly via their
publications on the web. The other two programs are readily accessible however,
and in this analysis, they are run via R interfaces:

* The R package `seas` is used to run X-13ARIMA-SEATS

* The R package `RJDemetra` is used to run JDemetra+

Importantly, the default values of both packages have been used when running the
seasonal adjustment and trending algorithms.


## ABS time series data

The [Australian Bureau of Statistics](https://www.abs.gov.au/) (ABS) produces
seasonally adjusted and trend estimates for various publications containing
original time series. The relevant data are contained in various tables as Excel
spreadsheets under the 'Data downloads' section of the desired publication.

An example is *Table 1. Inventories, chain volume measures* in the March
2023 publication of 'Business Indicators, Australia' available at:

[https://www.abs.gov.au/statistics/economy/business-indicators/business-indicators-australia/mar-2023/5676001.xlsx](https://www.abs.gov.au/statistics/economy/business-indicators/business-indicators-australia/mar-2023/5676001.xlsx)

Each spreadsheet file contains the following sheets/tabs:

* **Index:** contains metadata about the time
series, such as the series type, units and frequency

* **Data1:** contains the original, seasonally adjusted and trend
estimates (any other tabs are ignored in this analysis)


## Loading required packages

```{r libraries, warning = FALSE, message = FALSE}
library(dplyr)
library(janitor)
library(lubridate)
library(readxl)
```

## Downloading and cleaning the data

The function below downloads and cleans the data and metadata via a given URL.
The URL points to the download link for a particular table of a particular
publication.

Note that the included series start and  end variables in the metadata ('Index'
tab of the downloaded spreadsheet) are ignored. The reason is because some
series values in the data ('Data1' tab) are suppressed, meaning these included
variables don't align with what's really in the data tab containing the time
series values. By creating series start and end variables based on the common
span across all series in the data tab ('complete cases'), errors are reduced
for series with potentially missing data at the start or end periods, and for a
given table (spreadsheet), all plots have the same time scale which aids
comparisons.


## Creating the time series

The following functions create the time series data ready to be seasonally
adjusted or trended, or plotted.


## Plotting the time series

The following function plots the seasonally adjusted or trend series produced by
X-13ARIMA-SEATS or JDemetra+ against the ABS version.


```{r examples-make_plot, echo = FALSE, eval = FALSE}
#' \dontrun{
#' # Construct URL to download ABS data
#' ABS <- "https://www.abs.gov.au/statistics/economy/" # ABS website (for economic statistics)
#' pub <- "business-indicators/business-indicators-australia/" # Publication
#' ref <- "mar-2023/" # Reference period
#' cat <- "567600" # Catalogue number
#' tab <- "3.xlsx" # Table number
#' URL <- paste0(ABS, pub, ref, cat, tab)
#' 
#' # Download and plot data
#' sales <- download_ts(URL)
#' sales_plots <- plot_ts(sales, "T")
#' for (p in sales_plots) print(p)
#' }
```

